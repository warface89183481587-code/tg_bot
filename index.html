<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∞–≥–∞–∑–∏–Ω</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .stage { display: none; }
    .active { display: block; }
    button { margin: 5px; padding: 10px 15px; }
    input, textarea { width: 100%; margin: 5px 0; padding: 8px; }
  </style>
</head>
<body>
  <h1>üõç –ú–∏–Ω–∏-–º–∞–≥–∞–∑–∏–Ω</h1>

  <!-- 1. –ö–∞—Ç–∞–ª–æ–≥ -->
  <div id="catalog" class="stage active">
    <h2>–ö–∞—Ç–∞–ª–æ–≥</h2>
    <div>
      <p>üì¶ –¢–æ–≤–∞—Ä 1 ‚Äî 1000 ‚ÇΩ</p>
      <button onclick="addToCart('–¢–æ–≤–∞—Ä 1', 1000)">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div>
      <p>üì¶ –¢–æ–≤–∞—Ä 2 ‚Äî 2000 ‚ÇΩ</p>
      <button onclick="addToCart('–¢–æ–≤–∞—Ä 2', 2000)">–ö—É–ø–∏—Ç—å</button>
    </div>
    <button onclick="nextStage('checkout')">‚û° –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <!-- 2. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ -->
  <div id="checkout" class="stage">
    <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
    <ul id="cartList"></ul>
    <p><b>–ò—Ç–æ–≥–æ:</b> <span id="total"></span> ‚ÇΩ</p>
    <button onclick="nextStage('delivery')">‚û° –î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</button>
    <button onclick="backStage('catalog')">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <!-- 3. –î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞ -->
  <div id="delivery" class="stage">
    <h2>–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</h2>
    <input id="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">
    <textarea id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
    <select id="payment">
      <option value="card">üí≥ –ö–∞—Ä—Ç–∞</option>
      <option value="cash">üíµ –ù–∞–ª–∏—á–Ω—ã–µ</option>
    </select>
    <button onclick="finishOrder()">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
    <button onclick="backStage('checkout')">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <!-- 4. –ò—Ç–æ–≥ -->
  <div id="result" class="stage">
    <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –ø–æ–∫—É–ø–∫–æ–π!</h2>
    <p>–í–∞—à –∑–∞–∫–∞–∑:</p>
    <ul id="finalList"></ul>
    <p><b>–ò—Ç–æ–≥–æ:</b> <span id="finalTotal"></span> ‚ÇΩ</p>
    <p>–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑ üôå</p>
  </div>

  <script>
    let cart = [];

    function addToCart(name, price) {
      cart.push({name, price});
      alert(name + " –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!");
    }

    function nextStage(stage) {
      document.querySelectorAll('.stage').forEach(div => div.classList.remove('active'));
      document.getElementById(stage).classList.add('active');

      if (stage === 'checkout') {
        let cartList = document.getElementById('cartList');
        cartList.innerHTML = "";
        let total = 0;
        cart.forEach(item => {
          let li = document.createElement('li');
          li.textContent = item.name + " ‚Äî " + item.price + " ‚ÇΩ";
          cartList.appendChild(li);
          total += item.price;
        });
        document.getElementById('total').textContent = total;
      }
    }

    function backStage(stage) {
      document.querySelectorAll('.stage').forEach(div => div.classList.remove('active'));
      document.getElementById(stage).classList.add('active');
    }

    function finishOrder() {
      const address = document.getElementById('address').value;
      const comment = document.getElementById('comment').value;
      const payment = document.getElementById('payment').value;

      let order = {
        cart,
        address,
        comment,
        payment,
        total: cart.reduce((sum, i) => sum + i.price, 0),
        time: new Date().toISOString()
      };

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑ –≤ –±–æ—Ç–∞
      Telegram.WebApp.sendData(JSON.stringify(order));

      // –ü–æ–∫–∞–∑ –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      document.querySelectorAll('.stage').forEach(div => div.classList.remove('active'));
      document.getElementById('result').classList.add('active');

      let finalList = document.getElementById('finalList');
      finalList.innerHTML = "";
      cart.forEach(item => {
        let li = document.createElement('li');
        li.textContent = item.name + " ‚Äî " + item.price + " ‚ÇΩ";
        finalList.appendChild(li);
      });
      document.getElementById('finalTotal').textContent = order.total;
    }
  </script>
</body>
</html>
