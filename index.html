<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∏–Ω–∏-–º–∞–≥–∞–∑–∏–Ω</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; color: var(--tg-theme-text-color); background: var(--tg-theme-bg-color); }
    .stage { display: none; }
    .stage.active { display: block; }
    .btn { padding: 12px 20px; margin: 8px 0; background: var(--tg-theme-button-color); color: var(--tg-theme-button-text-color); border:none; border-radius:8px; cursor:pointer; width:100%; }
    .small-btn { font-size:14px; padding:6px 10px; }
    input, select, textarea { width:100%; padding:8px; margin:6px 0; border-radius:6px; border:1px solid #ccc; }
    ul { list-style: none; padding:0; }
    li { margin:8px 0; }
  </style>
</head>
<body>
  <h1>–í–∞—à –º–∏–Ω–∏-–º–∞–≥–∞–∑–∏–Ω</h1>
  <div id="catalog" class="stage active">
    <h2>–ö–∞—Ç–∞–ª–æ–≥</h2>
    <div>
      <p>–ü–∏—Ä–æ–∂–æ–∫ —Å –∫–∞–ø—É—Å—Ç–æ–π ‚Äî 90 ‚ÇΩ <button class="small-btn" onclick="addToCart('–ü–∏—Ä–æ–∂–æ–∫ —Å –∫–∞–ø—É—Å—Ç–æ–π', 90)">–î–æ–±–∞–≤–∏—Ç—å</button></p>
      <p>–ü–∏—Ä–æ–∂–æ–∫ —Å –ª—É–∫–æ–º –∏ —è–π—Ü–æ–º ‚Äî 90 ‚ÇΩ <button class="small-btn" onclick="addToCart('–ü–∏—Ä–æ–∂–æ–∫ —Å –ª—É–∫–æ–º –∏ —è–π—Ü–æ–º', 90)">–î–æ–±–∞–≤–∏—Ç—å</button></p>
      <p>–•–ª–µ–± –Ω–∞ –∑–∞–∫–≤–∞—Å–∫–µ ‚Äî 250 ‚ÇΩ <button class="small-btn" onclick="addToCart('–•–ª–µ–± –Ω–∞ –∑–∞–∫–≤–∞—Å–∫–µ', 250)">–î–æ–±–∞–≤–∏—Ç—å</button></p>
    </div>
    <button class="btn" onclick="goTo('checkout')">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é</button>
  </div>

  <div id="checkout" class="stage">
    <h2>–ö–æ—Ä–∑–∏–Ω–∞ / –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h2>
    <ul id="cart-list"></ul>
    <p><b>–ò—Ç–æ–≥–æ:</b> <span id="cart-total">0</span> ‚ÇΩ</p>
    <button class="btn" onclick="goTo('delivery')">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</button>
    <button class="btn" onclick="goTo('catalog')">‚Üê –ù–∞–∑–∞–¥</button>
  </div>

  <div id="delivery" class="stage">
    <h2>–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</h2>
    <label>
      <input type="radio" name="deliv" value="pickup" checked onchange="setDelivery(this.value)"> –°–∞–º–æ–≤—ã–≤–æ–∑
    </label>
    <label>
      <input type="radio" name="deliv" value="courier" onchange="setDelivery(this.value)"> –ö—É—Ä—å–µ—Ä
    </label>
    <br/>
    <select id="payment-method" onchange="setPayment(this.value)">
      <option value="transfer">–ü–µ—Ä–µ–≤–æ–¥</option>
      <option value="cash">–ù–∞–ª–∏—á–Ω—ã–µ</option>
    </select>
    <textarea id="order-comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É..."></textarea>
    <button class="btn" onclick="sendOrder()">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
    <button class="btn" onclick="goTo('checkout')">‚Üê –ù–∞–∑–∞–¥</button>
  </div>

  <div id="finish" class="stage">
    <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –ø–æ–∫—É–ø–∫–æ–π!</h2>
    <ul id="final-list"></ul>
    <p><b>–ò—Ç–æ–≥–æ:</b> <span id="final-total">0</span> ‚ÇΩ</p>
    <button class="btn" onclick="resetShop()">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    const cart = [];
    let delivery = 'pickup', payment = 'transfer';

    function addToCart(name, price) {
      cart.push({ name, price });
      alert(`${name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`);
    }

    function updateCartUI() {
      const list = document.getElementById('cart-list');
      list.innerHTML = '';
      let total = 0;
      cart.forEach((item,i) => {
        total += item.price;
        const li = document.createElement('li');
        li.textContent = `${item.name} ‚Äî ${item.price} ‚ÇΩ`;
        list.appendChild(li);
      });
      document.getElementById('cart-total').textContent = total;
    }

    function goTo(stage) {
      document.querySelectorAll('.stage').forEach(s => s.classList.remove('active'));
      document.getElementById(stage).classList.add('active');
      if(stage === 'checkout') updateCartUI();
      if(stage === 'finish') showFinal();
    }

    function setDelivery(val) { delivery = val; }
    function setPayment(val) { payment = val; }

    function sendOrder() {
      if (!cart.length) { alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }
      const comment = document.getElementById('order-comment').value;
      const orderData = { cart, delivery, payment, comment, total: cart.reduce((a,b) => a + b.price, 0) };
      tg.sendData(JSON.stringify(orderData));
      goTo('finish');
    }

    function showFinal() {
      const list = document.getElementById('final-list');
      list.innerHTML = '';
      let total = 0;
      cart.forEach(item => {
        total += item.price;
        const li = document.createElement('li');
        li.textContent = `${item.name} ‚Äî ${item.price} ‚ÇΩ`;
        list.appendChild(li);
      });
      document.getElementById('final-total').textContent = total;
    }

    function resetShop() {
      cart.length = 0;
      document.getElementById('order-comment').value = '';
      delivery = 'pickup'; payment = 'transfer';
      goTo('catalog');
    }

    tg.expand();
  </script>
</body>
</html>
